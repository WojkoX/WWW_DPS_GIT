{% extends "base.html" %}
{% block content %}


<main class="app-content">
<div class="container">
<h3 class="mb-4">üìä Zestawienia i dokumenty ‚Äì ≈ºywienie</h3>

{% for floor, data in stats.items() %}
<hr class="my-5">

<div class="container">
  <div class="row justify-content-center">
    <div class="col-11">

      <h2 class="mb-3"><b>üè¢ Piƒôtro: {{ floor }}</b></h2>

      <table class="table table-bordered table-sm text-center mb-5">
        <thead class="table-light text-center">
          <tr>
            <th>Liczba mieszka≈Ñc√≥w og√≥≈Çem</th>
            <th>Osoby bƒôdƒÖce w szpitalu</th>
            <th>Osoby bƒôdƒÖce na przepustce</th>
          </tr>
        </thead>
        <tbody class="text-center">
          <tr>
            <td>{{ data.presence_summary.total }}</td>
            <td>{{ data.presence_summary.hospital }}</td>
            <td>{{ data.presence_summary.pass }}</td>
          </tr>
        </tbody>
      </table>

      <!-- TABELA G≈Å√ìWNA -->
      <table class="table table-bordered table-sm text-center mb-5">
        <thead class="table-light">
          <tr>
            <th>LP</th>
            <th>POK√ìJ</th>
            <th>NAZWISKO IMIƒò</th>
            <th>DIETA</th>
            <th>JE W POKOJU</th>
            <th>POSI≈ÅKI W POKOJU</th>
            <th>UWAGI</th>
          </tr>
        </thead>
        <tbody>
          {% for r in data.present_residents %}
          <tr>
            <td>{{ r.lp }}</td>
            <td>{{ r.room }}</td>
            <td>{{ r.name }}</td>
            <td>{{ r.diet }}</td>
            <td class="text-center">
              {% if r.eat_in_room %}
                <span class="text-success fw-bold">‚úî</span>
              {% else %}
                <span class="text-danger fw-bold">‚úñ</span>
              {% endif %}
            </td>
            <td>
              {% if r.meals %}
                {{ r.meals | join(", ") }}
              {% else %}
                ‚Äî
              {% endif %}
            </td>
            <td>{{ r.notes }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- ZESTAWIENIE 1 -->
      <h5 class="mt-4 mb-2">
        ZESTAWIENIE WSZYSTKICH MIESZKA≈ÉC√ìW SPO≈ªYWAJƒÑCYCH POSI≈ÅKI W POKOJACH
      </h5>

      <table class="table table-bordered table-sm text-center mb-5">
        <thead class="table-light">
          <tr>
            <th>Rodzaj diety</th>
            <th>≈öniadanie</th>
            <th>Obiad</th>
            <th>Kolacja</th>
            <th>w tym bezmleczna</th>
          </tr>
        </thead>
        <tbody>
          {% for diet, s in data.summary_eat_in_room.items() %}
          <tr>
            <td class="text-start fw-bold">{{ diet }}</td>
            <td>{{ s['≈õniadanie'] }}</td>
            <td>{{ s['obiad'] }}</td>
            <td>{{ s['kolacja'] }}</td>
            <td>{{ s['bezmleczna'] }}</td>
          </tr>
          {% endfor %}
          <tr class="fw-bold">
          <td>RAZEM</td>
          <td>{{ data.summary_eat_in_room.values() | sum(attribute='≈õniadanie') }}</td>
          <td>{{ data.summary_eat_in_room.values() | sum(attribute='obiad') }}</td>
          <td>{{ data.summary_eat_in_room.values() | sum(attribute='kolacja') }}</td>
          <td>{{ data.summary_eat_in_room.values() | sum(attribute='bezmleczna') }}</td>
        </tr>
        </tbody>
      </table>

      <!-- ZESTAWIENIE 2 -->
      <h5 class="mt-4 mb-2">
        ZESTAWIENIE W PRZYPADKU JAK WSZYSCY MIESZKA≈ÉCY SPO≈ªYWAJƒÑ POSI≈ÅKI W POKOJACH
      </h5>

      <table class="table table-bordered table-sm text-center">
        <thead class="table-light">
          <tr>
            <th>Rodzaj diety</th>
            <th>≈öniadanie</th>
            <th>Obiad</th>
            <th>Kolacja</th>
            <th>w tym bezmleczna</th>
          </tr>
        </thead>
        <tbody>
          {% for diet, s in data.summary_all_present.items() %}
          <tr>
            <td class="text-start fw-bold">{{ diet }}</td>
            <td>{{ s['≈õniadanie'] }}</td>
            <td>{{ s['obiad'] }}</td>
            <td>{{ s['kolacja'] }}</td>
            <td>{{ s['bezmleczna'] }}</td>
          </tr>
          {% endfor %}
          <tr class="fw-bold">
          <td>RAZEM</td>
          <td>{{ data.summary_all_present.values() | sum(attribute='≈õniadanie') }}</td>
          <td>{{ data.summary_all_present.values() | sum(attribute='obiad') }}</td>
          <td>{{ data.summary_all_present.values() | sum(attribute='kolacja') }}</td>
          <td>{{ data.summary_all_present.values() | sum(attribute='bezmleczna') }}</td>
        </tr>
        </tbody>
      </table>
              <div class="d-flex justify-content-end align-items-center gap-2 mt-3">

                  <form method="post"
                        action="{{ url_for('stats.floor_docx', floor=floor) }}"
                        class="m-0">
                    <button class="btn btn-outline-primary btn-sm">
                      üìÑ Generuj dokument DOCX
                    </button>
                  </form>

                  <form method="post"
                        action="{{ url_for('stats.generate_floor_pdf', floor=floor) }}"
                        class="m-0">
                    <button class="btn btn-danger btn-sm">
                      üñ®Ô∏è Pobierz PDF do druku
                    </button>
                  </form>

                  <a href="{{ url_for('print.floor_print', floor=floor) }}"
                    target="_blank"
                    class="btn btn-outline-dark btn-sm">
                    üñ®Ô∏è Druk HTML / PDF
                  </a>

          </div>

    </div>
  </div>
</div>

{% endfor %}
</div>
<hr><hr>
</main>
{% endblock %}
